<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today's Word</title>
    <link rel="stylesheet" href="styles.css">

    <!-- ê¸°ë³¸ Favicon -->
    <link rel="icon" href="../favicon/favicon.ico" type="image/x-icon">
    
    <!-- ë‹¤ì–‘í•œ í¬ê¸°ì˜ Favicon ì§€ì› -->
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon/favicon-32x32.png">
    
    <!-- Android & Chrome Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="../favicon/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../favicon/android-chrome-512x512.png">
    
    <!-- Apple iOS Touch Icon -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- Web App Manifest (PWA ì§€ì›) -->
    <link rel="manifest" href="site.webmanifest">

    <!-- ğŸ–¼ Open Graph (SNS ê³µìœ  ë¯¸ë¦¬ë³´ê¸°) -->
    <meta property="og:title" content="Restart English - Today's Word">
    <meta property="og:description" content="Expand your vocabulary with today's word!">
    <meta property="og:image" content="https://restartenglish.github.io/preview.png">
    <meta property="og:url" content="https://restartenglish.github.io/word.html">
</head>
<body>
    <div class="container">
        <h1>ğŸ“– Today's Word</h1>
        
        <div class="word-card">
            <h2 id="content">Loading...</h2>
            <p id="phonetic" class="small">Pronunciation: Loading...</p>
            <p id="definition" class="definition">Meaning: Loading...</p>
            <div class="button-group">
                <button onclick="speakWord('en-US')">ğŸ”Š US</button>
                <button onclick="speakWord('en-GB')">ğŸ”Š UK</button>
                <button onclick="loadRandom()">ğŸ² Random</button>
                <button onclick="loadNext()">â¡ï¸ Next</button>
                <button onclick="share()">ğŸ“¤ Share</button>
            </div>
        </div>

        <a class="home" href="index.html">ğŸ  Back to Home</a>
    </div>

    <script>
        let words = [];
        let voices = [];

        // ğŸŒ ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„± ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë™ê¸° ë¡œë”©)
        function loadVoices() {
            voices = speechSynthesis.getVoices();
        }

        // ğŸ›  ìŒì„±ì´ ë¡œë“œë  ë•Œ ì´ë²¤íŠ¸ ì¶”ê°€
        speechSynthesis.onvoiceschanged = loadVoices;

        async function loadContent() {
            try {
                const response = await fetch("../data/word.txt");
                const text = await response.text();
                words = text.split("\n").filter(w => w.trim() !== "");
                
                const today = new Date();
                const index = today.getUTCFullYear() * 100 + today.getUTCDate();
                displayWord(index % words.length);
            } catch (error) {
                document.getElementById("content").innerText = "Error loading word.";
            }
        }

        async function displayWord(index) {
            const word = words[index];
            document.getElementById("content").innerText = word;
            
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                
                document.getElementById("definition").innerText = "Meaning: " + (data[0]?.meanings[0]?.definitions[0]?.definition || "No definition found.");
                document.getElementById("phonetic").innerText = "Pronunciation: " + (data[0]?.phonetic || "N/A");
            } catch {
                document.getElementById("definition").innerText = "Meaning: No definition found.";
                document.getElementById("phonetic").innerText = "Pronunciation: N/A";
            }
        }

        function speakWord(lang) {
            const word = document.getElementById("content").innerText;
            const utterance = new SpeechSynthesisUtterance(word);

            // ğŸ‡ºğŸ‡¸ ë¯¸êµ­ì‹ ë°œìŒ ì§€ì •
            if (lang === "en-US") {
                utterance.voice = voices.find(v => v.lang === "en-US" && v.name.includes("Google")) || voices.find(v => v.lang === "en-US");
            }
            
            // ğŸ‡¬ğŸ‡§ ì˜êµ­ì‹ ë°œìŒ ì§€ì •
            if (lang === "en-GB") {
                utterance.voice = voices.find(v => v.lang === "en-GB" && v.name.includes("Google")) || voices.find(v => v.lang === "en-GB");
            }

            utterance.lang = lang; // ì–¸ì–´ ì„¤ì •

            // ğŸ¯ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € í˜¸í™˜ ë¬¸ì œ í•´ê²°
            utterance.onstart = () => console.log("Speech started");
            utterance.onend = () => console.log("Speech ended");

            try {
                speechSynthesis.speak(utterance);
            } catch (e) {
                console.log("TTS blocked, retrying...");
                setTimeout(() => speechSynthesis.speak(utterance), 500);
            }
        }

        function loadRandom() {
            const randomIndex = Math.floor(Math.random() * words.length);
            displayWord(randomIndex);
        }

        function loadNext() {
            let index = words.indexOf(document.getElementById("content").innerText);
            index = (index + 1) % words.length;
            displayWord(index);
        }

        function share() {
            const word = document.getElementById("content").innerText;
            const url = window.location.href;
            const text = `Today's Word: ${word} - Learn more at ${url}`;

            if (navigator.share) {
                navigator.share({ title: "Restart English", text, url });
            } else {
                prompt("Copy this link:", url);
            }
        }

        loadContent();
    </script>
</body>
</html>
