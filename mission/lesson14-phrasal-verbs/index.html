<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>구동사 퀴즈 - 10문제 일괄출제</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
      margin: 0;
    }

    .quiz-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 700px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .question-block {
      margin-bottom: 30px;
    }

    h2 {
      font-size: 1.3em;
    }

    .option {
      margin: 8px 0;
      padding: 12px;
      border-radius: 6px;
      background: #e0e0e0;
      cursor: pointer;
      font-size: 1.1em;
    }

    .option:hover {
      background: #d0d0d0;
    }

    .selected {
      background: #b3e5fc !important;
    }

    .result {
      margin-top: 20px;
      padding: 12px;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      border-radius: 5px;
      font-size: 1em;
      line-height: 1.6;
    }

    button {
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 1.1em;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #1976d2;
      color: white;
    }

    @media (max-width: 480px) {
      .quiz-box {
        padding: 16px;
      }

      .option {
        font-size: 1em;
        padding: 10px;
      }

      h2 {
        font-size: 1.1em;
      }

      .result {
        font-size: 0.95em;
      }

      button {
        width: 100%;
        font-size: 1.2em;
      }
    }
  </style>
</head>
<body>
  <div class="quiz-box" id="quiz-container">
    <h1>구동사 퀴즈 (10문제)</h1>
    <div id="questions"></div>
    <button onclick="showResults()">제출</button>
    <div id="result" class="result"></div>
  </div>

  <script>
    let userAnswers = {};
    let questionList = [];

    async function loadQuestions() {
      const res = await fetch('questions.txt');
      const text = await res.text();
      const all = text.trim().split('\n').map(line => {
        const [phrasal, meaning, example] = line.split('\t');
        return { phrasal, meaning, example };
      });

      questionList = shuffle(all).slice(0, 10);
      const container = document.getElementById('questions');
      container.innerHTML = '';

      questionList.forEach((q, index) => {
        const qid = `q${index}`;
        const options = shuffle([q.meaning, ...shuffle(all.filter(x => x.meaning !== q.meaning)).slice(0, 3).map(x => x.meaning)]);

        const block = document.createElement('div');
        block.className = 'question-block';

        const title = document.createElement('h2');
        title.innerText = `Q${index + 1}. "${q.phrasal}" 의 뜻은?`;
        block.appendChild(title);

        options.forEach(opt => {
          const optDiv = document.createElement('div');
          optDiv.className = 'option';
          optDiv.innerText = opt;
          optDiv.onclick = () => {
            const all = block.querySelectorAll('.option');
            all.forEach(o => o.classList.remove('selected'));
            optDiv.classList.add('selected');
            userAnswers[qid] = opt;
          };
          block.appendChild(optDiv);
        });

        container.appendChild(block);
      });
    }

    function showResults() {
      const resultBox = document.getElementById('result');
      resultBox.innerHTML = '';

      let wrongCount = 0;

      questionList.forEach((q, index) => {
        const qid = `q${index}`;
        const userAnswer = userAnswers[qid];
        if (userAnswer && userAnswer !== q.meaning) {
          wrongCount++;
          const block = document.createElement('div');
          block.innerHTML = `<strong>Q${index + 1}. "${q.phrasal}"</strong><br>
          당신의 답: ${userAnswer} ❌<br>
          정답: ${q.meaning}<br>
          예문: ${q.example}<br><br>`;
          resultBox.appendChild(block);
        }
      });

      const summary = document.createElement('div');
      summary.innerHTML = `<strong>${wrongCount === 0 ? "모든 문제를 맞췄습니다! 🎉" : `총 ${wrongCount}문제 틀렸습니다.`}</strong><br><br>`;
      resultBox.prepend(summary);
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    loadQuestions();
  </script>
</body>
</html>
