<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Little Prince Reader</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      margin: 0;
    }
    #reader {
      flex: 2;
      padding: 20px;
      line-height: 1.6;
    }
    #wordlist {
      flex: 1;
      background: #f5f5f5;
      padding: 20px;
      border-left: 1px solid #ddd;
    }
    .highlight-green { background-color: #ccff00; }
    .highlight-blue { background-color: #00ffff; }
    .highlight-pink { background-color: #ff66cc; }
    .sentence:hover {
      background-color: rgba(255,255,0,0.3);
      cursor: pointer;
    }
    h1 { font-size: 24px; }
    h2 { font-size: 20px; margin-top: 1em; }
    strong { font-weight: bold; }
  </style>
</head>
<body>

<div id="reader">📖 Loading <code>thelittleprince.txt</code>...</div>
<div id="wordlist"><h3>📌 Word List</h3><ul id="words"></ul></div>

<script>
function parseText(raw) {
  const lines = raw.trim().split('\n');
  const container = document.createElement('div');
  const wordSet = new Set();

  for (let line of lines) {
    let element;

    // 제목/부제목
    if (line.startsWith('## ')) {
      element = document.createElement('h2');
      line = line.replace(/^## /, '');
    } else if (line.startsWith('# ')) {
      element = document.createElement('h1');
      line = line.replace(/^# /, '');
    } else {
      element = document.createElement('p');
    }

    // 굵은 글씨
    line = line.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

    // 하이라이트
    line = line.replace(/==green==(.*?)==green==/g, '<span class="highlight-green">$1</span>');
    line = line.replace(/==blue==(.*?)==blue==/g, '<span class="highlight-blue">$1</span>');
    line = line.replace(/==pink==(.*?)==pink==/g, '<span class="highlight-pink">$1</span>');

    if (element.tagName === 'P') {
      const sentenceParts = line.match(/[^.!?]+[.!?]?/g) || [];
      sentenceParts.forEach(part => {
        const span = document.createElement('span');
        span.className = 'sentence';
        span.textContent = part.trim() + ' ';
        span.onclick = () => {
          const utterance = new SpeechSynthesisUtterance(part.trim());
          utterance.lang = 'en-US';
          speechSynthesis.speak(utterance);
        };
        element.appendChild(span);

        // 단어 추출
        part.trim().split(/\W+/).forEach(word => {
          if (word.length > 3) wordSet.add(word.toLowerCase());
        });
      });
    } else {
      element.innerHTML = line;
    }

    container.appendChild(element);
  }

  // 단어 목록 표시
  const ul = document.getElementById('words');
  ul.innerHTML = '';
  [...wordSet].sort().forEach(w => {
    const li = document.createElement('li');
    li.textContent = w;
    ul.appendChild(li);
  });

  return container;
}

// 실제 텍스트 파일 불러오기
fetch('./thelittleprince.txt')
  .then(response => response.text())
  .then(text => {
    const parsed = parseText(text);
    const readerDiv = document.getElementById('reader');
    readerDiv.innerHTML = '';
    readerDiv.appendChild(parsed);
  })
  .catch(err => {
    document.getElementById('reader').textContent = '❌ Failed to load text file.';
    console.error(err);
  });
</script>

</body>
</html>
